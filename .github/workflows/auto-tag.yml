# 工作流名称：自动打语义化标签（v*格式）
name: Auto Create Semantic Tag

# 触发条件：向main分支推送代码时触发（可修改为你的开发分支，如dev）
# 注意：仅在提交代码时触发，打标签本身不会重复触发
on:
  push:
    branches:
      - main
    # 排除标签推送的触发（避免循环）
    tags-ignore:
      - 'v*'
  workflow_dispatch: # 允许手动触发

jobs:
  auto-tag:
    runs-on: ubuntu-latest
    steps:
      # 拉取仓库代码
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # 拉取所有提交记录，用于判断版本升级
          fetch-depth: 0

      # 核心Action：自动打语义化标签（v*格式）
      - name: Auto Generate Tag
        uses: anothrNick/github-tag-action@v1
        env:
          # 使用GitHub内置令牌，无需手动配置
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # 标签前缀：固定为v，生成v1.0.0、v2.0.1格式（必须和Release Workflow匹配）
          DEFAULT_BUMP: patch # 默认升级类型：patch（补丁更新，如v2.0.0→v2.0.1）
          # 以下是提交信息关键字，触发对应版本升级（可自定义）
          # feat: xxx → minor（小版本，v2.0.0→v2.1.0）
          # BREAKING CHANGE / !: → major（大版本，v2.0.0→v3.0.0）
          # 其他提交（fix:、docs:等）→ patch（补丁更新）
          TAG_PREFIX: v
          RELEASE_BRANCHES: main # 仅在main分支触发自动打标签
          VERBOSE: true # 输出详细日志，方便排查
# 故障排除指南

## 📋 编译问题

### 问题 1: 编译时提示缺少 Visual Studio Build Tools

**错误信息**:
```
error: linker `link.exe` not found
```

**解决方案**:
1. 访问 https://visualstudio.microsoft.com/downloads/
2. 下载 "Build Tools for Visual Studio"
3. 运行安装程序，选择 "C++ build tools" 工作负载
4. 重启命令行并重新编译

---

### 问题 2: Cargo 下载依赖失败

**错误信息**:
```
error: failed to download from ...
```

**解决方案**:

**方法 1: 使用国内镜像源**
在 `%USERPROFILE%\.cargo\config.toml` 添加：
```toml
[source.crates-io]
replace-with = 'ustc'

[source.ustc]
registry = "https://mirrors.ustc.edu.cn/crates.io-index"
```

**方法 2: 检查网络连接**
- 确保网络畅通
- 尝试使用 VPN
- 检查防火墙设置

---

### 问题 3: Windows features 错误

**错误信息**:
```
package depends on `windows` with feature `Win32_Media_Audio_CoreAudio` 
but `windows` does not have that feature
```

**解决方案**:
这个问题已在最新版本修复。确保使用最新的 Cargo.toml 文件。

---

## 🎙️ 录音问题

### 问题 4: 无法录制扬声器声音

**症状**: 只能听到麦克风的声音，听不到电脑播放的声音

**解决方案**:

**步骤 1: 启用立体声混音**
1. 右键任务栏音量图标
2. 选择"声音设置"
3. 点击"声音控制面板"
4. 切换到"录制"选项卡
5. 右键空白处，勾选"显示已禁用的设备"
6. 找到"立体声混音"设备
7. 右键点击，选择"启用"
8. 重启程序

**步骤 2: 检查默认设备**
某些情况下需要将立体声混音设置为默认设备：
1. 在"录制"选项卡
2. 右键"立体声混音"
3. 选择"设置为默认设备"

**步骤 3: 调整音量**
确保立体声混音的音量不是静音状态。

---

### 问题 5: 录音有杂音或断断续续

**可能原因**:
- CPU 占用过高
- 音频缓冲区太小
- 采样率设置不当

**解决方案**:

**降低音质设置**:
编辑配置文件，降低采样率和比特率：
```toml
[audio]
sample_rate = 22050  # 从 44100 降低到 22050
bitrate = 64         # 从 128 降低到 64
quality = 5          # 从 2 提高到 5（数字越大质量越低）
```

**关闭其他程序**:
- 关闭占用 CPU 的程序
- 关闭浏览器多余的标签页

---

### 问题 6: 自动录音不工作

**症状**: 打开通话软件后没有自动开始录音

**检查清单**:

**1. 检查配置文件**
```toml
auto_record = true  # 必须为 true
```

**2. 检查监控应用列表**
确保应用在列表中：
```toml
monitored_apps = [
    "WeChat.exe",
    "QQ.exe",
    # ... 其他应用
]
```

**3. 验证应用名称**
打开任务管理器，查看实际的进程名：
1. Ctrl + Shift + Esc 打开任务管理器
2. 找到通话软件
3. 右键 → 转到详细信息
4. 查看"名称"列的值
5. 将该名称添加到配置文件

**4. 重启程序**
修改配置后必须重启程序。

---

### 问题 7: 录音文件太大

**原因**: 高音质设置导致文件较大

**解决方案**:

根据需求调整配置：

**语音通话**（推荐）:
```toml
[audio]
sample_rate = 16000
bitrate = 64
channels = 1
quality = 5
```
文件大小: 约 0.5 MB/分钟

**普通会议**:
```toml
[audio]
sample_rate = 22050
bitrate = 96
channels = 2
quality = 4
```
文件大小: 约 0.7 MB/分钟

**高质量会议**:
```toml
[audio]
sample_rate = 44100
bitrate = 128
channels = 2
quality = 2
```
文件大小: 约 1 MB/分钟

---

### 问题 8: 录音质量不好

**症状**: 音质模糊、声音小、有杂音

**解决方案**:

**提高音质设置**:
```toml
[audio]
sample_rate = 48000  # 提高采样率
bitrate = 192        # 提高比特率
channels = 2         # 使用立体声
quality = 0          # 最高质量
```

**调整麦克风音量**:
1. 右键任务栏音量图标
2. 声音设置 → 输入设备
3. 调整麦克风音量

**调整扬声器音量**:
1. 声音设置 → 录制
2. 右键立体声混音 → 属性
3. 级别选项卡
4. 调整音量

---

## 🖥️ GUI 问题

### 问题 9: GUI 窗口无法打开

**错误信息**:
```
thread 'main' panicked at ...
```

**解决方案**:

**方法 1: 使用命令行模式**
```bash
auto-audio-recorder.exe run
```

**方法 2: 检查显卡驱动**
更新显卡驱动程序

**方法 3: 删除配置文件**
删除 `%APPDATA%\auto-audio-recorder\config.toml`，让程序重新创建

---

### 问题 10: 程序崩溃或闪退

**收集错误信息**:
在命令行运行程序以查看错误信息：
```bash
auto-audio-recorder.exe gui
```

**常见原因**:
1. 配置文件格式错误
2. 音频设备访问权限问题
3. 内存不足

**解决步骤**:
1. 检查配置文件语法
2. 以管理员身份运行
3. 重启电脑
4. 重新安装程序

---

## 🔐 权限问题

### 问题 11: 无法访问麦克风

**错误信息**:
```
未找到默认输入设备
```

**解决方案**:

**检查麦克风权限**:
1. Windows 设置
2. 隐私 → 麦克风
3. 允许应用访问麦克风
4. 确保程序在列表中且已启用

**检查麦克风设备**:
1. 右键任务栏音量图标
2. 声音设置
3. 确保已选择正确的输入设备

---

### 问题 12: 需要管理员权限

**症状**: 某些功能无法正常工作

**解决方案**:
右键程序，选择"以管理员身份运行"

---

## 📁 文件问题

### 问题 13: 找不到录音文件

**默认位置**:
```
C:\Users\你的用户名\Documents\AudioRecordings\
```

**查看配置的位置**:
```bash
auto-audio-recorder.exe config
```

**修改保存位置**:
编辑配置文件中的 `output_dir`

---

### 问题 14: 录音文件损坏

**可能原因**:
- 录音过程中程序崩溃
- 磁盘空间不足
- 文件系统错误

**预防措施**:
- 确保有足够的磁盘空间
- 定期备份重要录音
- 使用稳定版本的程序

---

## 🆘 获取帮助

如果以上方法都无法解决您的问题：

1. **查看日志**:
   ```bash
   $env:RUST_LOG="debug"; auto-audio-recorder.exe run
   ```

2. **提交 Issue**:
   访问 https://github.com/yourusername/auto-audio-recorder/issues
   提供以下信息：
   - Windows 版本
   - 程序版本
   - 错误信息
   - 操作步骤
   - 配置文件内容

3. **社区讨论**:
   在 GitHub Discussions 发起讨论

---

## 💡 最佳实践

### 使用建议

1. **首次使用**:
   - 先使用默认设置
   - 测试录音功能正常后再调整

2. **定期维护**:
   - 定期清理旧录音
   - 检查磁盘空间
   - 更新到最新版本

3. **备份重要录音**:
   - 重要录音及时备份到云端
   - 使用多个存储位置

4. **合理设置音质**:
   - 语音通话: 16kHz, 64kbps
   - 普通会议: 22kHz, 96kbps
   - 重要会议: 44kHz, 128kbps

---

**更新日期**: 2024-12-07
